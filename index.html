<html>
    <head>
        <meta charset="utf-8">
        <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.12&key=b13f6876e663ab305271e2573011a967"></script>
        <script src="https://cdn.staticfile.org/jquery/3.3.1/jquery.min.js"></script>
    </head>
    
    <body>
        <div style="border: 1px solid gray;padding: 15px;">
            <h5>1. 获取两个经纬度之间的距离：</h5>
            <h6 style="color: brown">备注：txt文件格式: 经度1,纬度1|经度2,纬度2
                例如：<br/>
                121.506974,31.328589|121.506545,31.32221<br/>
                121.532122,31.322723|121.532036,31.315024
            </h6>
            <input type="file" id="file1" onchange="getDistances(this.id)"/>
        </div>

        <div style="border: 1px solid gray; margin-top: 30px;padding: 15px;">
            <h5>2. 根据经纬度获取地址</h5>
            <h6 style="color: brown">备注：txt文件格式：经度,纬度<br/>
                例如：<br/>
                121.491649,31.332118<br/>
                121.484439,31.319873<br/>
                121.485297,31.305721<br/>
            </h6>
            <input type="file" id="file2" onchange="getAddresses(this.id)"/>
        </div>

        <div style="border: 1px solid gray; margin-top: 30px;padding: 15px;">
            <h5>3. 根据地址获取经纬度</h5>
            <h6 style="color: brown">备注：txt文件格式：地址<br/>
                例如: <br/>
                上海市宝山区淞南镇长江南路(地铁站)<br/>
                上海市宝山区高境镇逸仙路1400号<br/>
                上海市虹口区江湾镇街道逸仙高架路
            </h6>
            <input type="file" id="file3" onchange="getLongitudeALatitude(this.id)"/>
        </div>
    </body>

<script>

    // 批量转换地址为经纬度
    function getLongitudeALatitude(id){
        var a = $("#"+id);
        var selectedFile = $("#"+id)[0].files[0];
        var reader = new FileReader();//new一个FileReader实例
        reader.onload = function() {
            var arr = this.result.split("\n");
            getLonALati(arr, 0, "");
        }
        reader.readAsText(selectedFile);
    }

    // 批量转换经纬度
    function getAddresses(id){
        var a = $("#"+id);
        var selectedFile = $("#"+id)[0].files[0];
        var reader = new FileReader();//new一个FileReader实例
        reader.onload = function() {
            var arr = this.result.split("\n");
            getAddress(arr,0,"");
        }
        reader.readAsText(selectedFile);
    }

    // 批量获取两组经纬度之间的距离
    function getDistances(id){
        var a = $("#"+id);
        var selectedFile = $("#"+id)[0].files[0];
        var reader = new FileReader();//new一个FileReader实例
        reader.onload = function() {
            var arr = this.result.split("\n");
            var results = "";
            for (let i = 0; i < arr.length; i++) {
                var item = arr[i];
                var subItemArr = item.split("|"); // longitude, latitude
                var firstArr = subItemArr[0].split(",");
                var secondArr = subItemArr[1].split(",");
                var rs = getDistance(firstArr[0], firstArr[1], secondArr[0], secondArr[1]);
                results += rs + "\n";
            }

            funDownload(results, "result.txt");
        }
        reader.readAsText(selectedFile);
    }

    // 获取两个经纬度之间的距离
    function getDistance(firstLon, firstLat, secondeLon, secondeLat) {
        var lnglat1 = new AMap.LngLat(firstLon, firstLat);
        var lnglat2 = new AMap.LngLat(secondeLon, secondeLat);
        var distance = lnglat1.distance(lnglat2);//计算lnglat1到lnglat2之间的实际距离(m)
        return distance;
    }

    // 获取某个经纬度对应的地址
    function getAddress(addresses, index, rs) {

        if (index == addresses.length) {
            funDownload(rs, "result.txt");
            return
        }

        var item = addresses[index];
        if (item == "") {
            funDownload(rs, "result.txt");
            return
        }
        var longALat = item.split(",");

        AMap.plugin('AMap.Geocoder', function() {
            var geocoder = new AMap.Geocoder()

            // var lnglat = [long, lati]

            geocoder.getAddress(longALat, function(status, result) {
                if (status === 'complete' && result.info === 'OK') {
                    // result为对应的地理位置详细信息
                    rs += result.regeocode.formattedAddress + "\n";
                    getAddress(addresses, index + 1, rs);
                }
            })
        })
    }

    // 获取某个地址的经纬度
    function getLonALati(addresses, index, rs) {

        if (index == addresses.length) {
            funDownload(rs, "result.txt");
            return;
        }

        var address = addresses[index];
        if (address == "") {
            funDownload(rs, "result.txt");
            return;
        }

        AMap.plugin('AMap.Geocoder', function() {
            var geocoder = new AMap.Geocoder();

            geocoder.getLocation(address, function(status, result) {
                if (status === 'complete' && result.info === 'OK') {
                    // result中对应详细地理坐标信息
                    rs += result.geocodes[0].location.lng + "," + result.geocodes[0].location.lat + "\n";
                    getLonALati(addresses, index + 1, rs);
                }
            })
        })
    }

    // 下载文件
    var funDownload = function (content, filename) {
        var eleLink = document.createElement('a');
        eleLink.download = filename;
        eleLink.style.display = 'none';
        var blob = new Blob([content]);
        eleLink.href = URL.createObjectURL(blob);
        document.body.appendChild(eleLink);
        eleLink.click();
        document.body.removeChild(eleLink);
    };
</script>
</html>
